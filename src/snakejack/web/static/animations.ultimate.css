/* Advanced animation curves and variables */
:root {
    /* Easing curves */
    --bounce-out: cubic-bezier(0.34, 1.56, 0.64, 1);
    --smooth-out: cubic-bezier(0.4, 0, 0.2, 1);
    --elastic: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    --snap: cubic-bezier(0.4, 0, 0.6, 1);
    
    /* Animation speeds */
    --speed-fast: 0.3s;
    --speed-normal: 0.5s;
    --speed-slow: 0.8s;
    
    /* 3D perspective settings */
    --card-perspective: 1500px;
    --depth-offset: 100px;
    
    /* Glow effects */
    --glow-win: 0 0 20px rgba(0, 255, 0, 0.5), 0 0 40px rgba(0, 255, 0, 0.3), 0 0 60px rgba(0, 255, 0, 0.1);
    --glow-lose: 0 0 20px rgba(255, 0, 0, 0.5), 0 0 40px rgba(255, 0, 0, 0.3), 0 0 60px rgba(255, 0, 0, 0.1);
    --glow-push: 0 0 20px rgba(255, 255, 0, 0.5), 0 0 40px rgba(255, 255, 0, 0.3), 0 0 60px rgba(255, 255, 0, 0.1);
    
    /* Color schemes */
    --win-gradient: linear-gradient(45deg, #00ff00, #00cc00, #009900);
    --lose-gradient: linear-gradient(45deg, #ff0000, #cc0000, #990000);
    --push-gradient: linear-gradient(45deg, #ffff00, #cccc00, #999900);
}

/* Enhanced 3D card dealing animation */
@keyframes dealCard {
    0% {
        opacity: 0;
        transform: perspective(var(--card-perspective)) 
                  translateY(-300px) 
                  translateZ(calc(var(--depth-offset) * -3)) 
                  rotate3d(1, 1, 0, 60deg);
        filter: blur(10px);
    }
    40% {
        opacity: 1;
        transform: perspective(var(--card-perspective)) 
                  translateY(30px) 
                  translateZ(calc(var(--depth-offset) * 0.5)) 
                  rotate3d(1, 1, 0, -15deg);
        filter: blur(0);
    }
    70% {
        transform: perspective(var(--card-perspective)) 
                  translateY(-15px) 
                  translateZ(calc(var(--depth-offset) * 0.25)) 
                  rotate3d(1, 1, 0, 7deg);
    }
    85% {
        transform: perspective(var(--card-perspective)) 
                  translateY(5px) 
                  translateZ(calc(var(--depth-offset) * 0.1)) 
                  rotate3d(1, 1, 0, -3deg);
    }
    100% {
        opacity: 1;
        transform: perspective(var(--card-perspective)) 
                  translateY(0) 
                  translateZ(0) 
                  rotate3d(1, 1, 0, 0deg);
        filter: blur(0);
    }
}

/* Enhanced 3D card flip with shadow movement */
@keyframes flipCard {
    0% {
        transform: perspective(var(--card-perspective)) rotateY(0deg);
        box-shadow: 0 8px 18px rgba(0,0,0,0.75);
        filter: brightness(1);
    }
    25% {
        transform: perspective(var(--card-perspective)) 
                  rotateY(45deg) 
                  translateZ(20px);
        box-shadow: -20px 8px 25px rgba(0,0,0,0.5);
        filter: brightness(0.9);
    }
    75% {
        transform: perspective(var(--card-perspective)) 
                  rotateY(135deg) 
                  translateZ(20px);
        box-shadow: 20px 8px 25px rgba(0,0,0,0.5);
        filter: brightness(0.9);
    }
    100% {
        transform: perspective(var(--card-perspective)) rotateY(180deg);
        box-shadow: 0 8px 18px rgba(0,0,0,0.75);
        filter: brightness(1);
    }
}

/* Enhanced highlight pulse with 3D effect and glow */
@keyframes highlightPulse {
    0% {
        box-shadow: 0 8px 18px rgba(0,0,0,0.75);
        transform: perspective(var(--card-perspective)) translateZ(0);
        filter: brightness(1);
    }
    25% {
        box-shadow: 0 15px 30px var(--highlight-color, rgba(179,0,21,0.6));
        transform: perspective(var(--card-perspective)) 
                  translateZ(calc(var(--depth-offset) * 0.3)) 
                  scale(1.03);
        filter: brightness(1.2);
    }
    50% {
        box-shadow: var(--highlight-glow);
        transform: perspective(var(--card-perspective)) 
                  translateZ(calc(var(--depth-offset) * 0.5)) 
                  scale(1.05);
        filter: brightness(1.3);
    }
    75% {
        box-shadow: 0 15px 30px var(--highlight-color, rgba(179,0,21,0.6));
        transform: perspective(var(--card-perspective)) 
                  translateZ(calc(var(--depth-offset) * 0.3)) 
                  scale(1.03);
        filter: brightness(1.2);
    }
    100% {
        box-shadow: 0 8px 18px rgba(0,0,0,0.75);
        transform: perspective(var(--card-perspective)) translateZ(0);
        filter: brightness(1);
    }
}

/* Enhanced result animation with 3D effects */
@keyframes resultPopIn {
    0% {
        opacity: 0;
        filter: blur(15px) brightness(2);
        transform: perspective(var(--card-perspective)) 
                  scale(0.7) 
                  translateY(70px) 
                  rotateX(-45deg);
    }
    40% {
        opacity: 1;
        filter: blur(0) brightness(1.3);
        transform: perspective(var(--card-perspective)) 
                  scale(1.15) 
                  translateY(-15px) 
                  rotateX(10deg);
    }
    70% {
        transform: perspective(var(--card-perspective)) 
                  scale(0.95) 
                  translateY(7px) 
                  rotateX(-5deg);
        filter: brightness(1.1);
    }
    100% {
        opacity: 1;
        filter: blur(0) brightness(1);
        transform: perspective(var(--card-perspective)) 
                  scale(1) 
                  translateY(0) 
                  rotateX(0);
    }
}

/* Enhanced bust shake with 3D rotation */
@keyframes shakeBust {
    0%, 100% {
        transform: perspective(var(--card-perspective)) 
                  translateX(0) 
                  rotate3d(0, 1, 0, 0deg);
        filter: brightness(1);
    }
    20% {
        transform: perspective(var(--card-perspective)) 
                  translateX(-20px) 
                  rotate3d(0, 1, 0, -8deg);
        filter: brightness(1.2);
    }
    40% {
        transform: perspective(var(--card-perspective)) 
                  translateX(20px) 
                  rotate3d(0, 1, 0, 8deg);
        filter: brightness(1.1);
    }
    60% {
        transform: perspective(var(--card-perspective)) 
                  translateX(-15px) 
                  rotate3d(0, 1, 0, -5deg);
        filter: brightness(1.2);
    }
    80% {
        transform: perspective(var(--card-perspective)) 
                  translateX(15px) 
                  rotate3d(0, 1, 0, 5deg);
        filter: brightness(1.1);
    }
}

/* Enhanced button hover with glow */
@keyframes buttonHover {
    0% {
        transform: translateY(0);
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        filter: brightness(1);
    }
    100% {
        transform: translateY(-4px);
        box-shadow: 0 12px 20px rgba(0,0,0,0.4), 
                    0 0 30px rgba(179,0,21,0.3);
        filter: brightness(1.2);
    }
}

/* Enhanced card exit with 3D spin */
@keyframes cardExit {
    0% {
        opacity: 1;
        transform: perspective(var(--card-perspective)) 
                  scale(1) 
                  rotate3d(0, 1, 0, 0deg);
        filter: blur(0);
    }
    100% {
        opacity: 0;
        transform: perspective(var(--card-perspective)) 
                  scale(0.8) 
                  rotate3d(1, 1, 0, 120deg) 
                  translateY(150px);
        filter: blur(10px);
    }
}

/* Enhanced badge animations with 3D effects */
@keyframes badgeSlideIn {
    0% {
        opacity: 0;
        transform: perspective(var(--card-perspective)) 
                  translateX(70px) 
                  rotate3d(0, 1, 0, -120deg);
        filter: blur(15px) brightness(2);
    }
    60% {
        transform: perspective(var(--card-perspective)) 
                  translateX(-15px) 
                  rotate3d(0, 1, 0, 15deg);
        filter: blur(0) brightness(1.3);
    }
    80% {
        transform: perspective(var(--card-perspective)) 
                  translateX(5px) 
                  rotate3d(0, 1, 0, -5deg);
        filter: brightness(1.1);
    }
    100% {
        opacity: 1;
        transform: perspective(var(--card-perspective)) 
                  translateX(0) 
                  rotate3d(0, 1, 0, 0deg);
        filter: brightness(1);
    }
}

/* Enhanced victory celebration */
@keyframes celebrate {
    0%, 100% {
        transform: scale(1);
        filter: brightness(1);
    }
    25% {
        transform: scale(1.1) rotate(3deg);
        filter: brightness(1.3) contrast(1.1);
    }
    50% {
        transform: scale(1.15) rotate(-2deg);
        filter: brightness(1.4) contrast(1.15);
    }
    75% {
        transform: scale(1.1) rotate(1deg);
        filter: brightness(1.3) contrast(1.1);
    }
}

/* Enhanced sparkle effect */
@keyframes sparkle {
    0%, 100% {
        opacity: 0;
        transform: scale(0) rotate(0deg);
        filter: blur(5px);
    }
    50% {
        opacity: 1;
        transform: scale(1) rotate(180deg);
        filter: blur(0);
    }
}

/* Card styles and effects */
.card {
    animation: dealCard var(--speed-slow) var(--bounce-out);
    transition: all var(--speed-normal) var(--smooth-out);
    position: relative;
    transform-style: preserve-3d;
}

.card::before {
    content: '';
    position: absolute;
    inset: -2px;
    background: linear-gradient(
        45deg, 
        transparent, 
        rgba(255,255,255,0.2), 
        transparent
    );
    opacity: 0;
    transition: opacity var(--speed-normal) var(--smooth-out);
    border-radius: inherit;
    pointer-events: none;
}

.card::after {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(
        circle at 50% -50%,
        rgba(255,255,255,0.15),
        transparent 70%
    );
    opacity: 0;
    transition: opacity var(--speed-normal) var(--smooth-out);
    border-radius: inherit;
    pointer-events: none;
}

.card:hover::before,
.card:hover::after {
    opacity: 1;
}

.card:hover {
    transform: perspective(var(--card-perspective)) 
              translateY(-15px) 
              translateZ(30px) 
              scale(1.05);
    box-shadow: 0 20px 40px rgba(0,0,0,0.8), 
                0 0 30px rgba(179,0,21,0.2);
}

/* Enhanced flip animation */
.card.back.reveal {
    animation: flipCard var(--speed-slow) var(--smooth-out) forwards;
}

/* Enhanced win/lose effects */
.card.win {
    --highlight-color: rgba(0, 179, 21, 0.6);
    --highlight-glow: var(--glow-win);
    animation: highlightPulse 3s var(--smooth-out) infinite;
}

.card.lose {
    --highlight-color: rgba(179, 0, 21, 0.6);
    --highlight-glow: var(--glow-lose);
    animation: highlightPulse 3s var(--smooth-out) infinite;
}

.card.push {
    --highlight-color: rgba(179, 179, 21, 0.6);
    --highlight-glow: var(--glow-push);
    animation: highlightPulse 3s var(--smooth-out) infinite;
}

/* Enhanced bust effect */
.hand-status.busted {
    animation: shakeBust var(--speed-normal) var(--elastic);
    color: #ff3333;
    text-shadow: 0 0 15px rgba(255,0,0,0.7),
                 0 0 30px rgba(255,0,0,0.5);
}

/* Enhanced result display */
.result {
    animation: resultPopIn var(--speed-normal) var(--bounce-out);
    position: relative;
}

.result.win {
    animation: resultPopIn var(--speed-normal) var(--bounce-out),
               celebrate 3s var(--smooth-out) infinite;
}

/* Victory sparkles */
.result.win::before,
.result.win::after {
    content: '';
    position: absolute;
    width: 30px;
    height: 30px;
    background: radial-gradient(
        circle,
        rgba(255,255,255,0.9),
        rgba(255,255,255,0.5) 30%,
        transparent 70%
    );
    animation: sparkle 2s var(--bounce-out) infinite;
}

.result.win::before {
    left: -40px;
    top: 50%;
    animation-delay: 0.3s;
}

.result.win::after {
    right: -40px;
    top: 50%;
    animation-delay: 0.6s;
}

/* Enhanced badge effects */
.cheat-badge {
    animation: badgeSlideIn var(--speed-normal) var(--bounce-out);
    box-shadow: 0 6px 16px rgba(0,0,0,0.6),
                0 0 20px rgba(179,0,21,0.3);
}

.cheat-badge.exit {
    animation: badgeSlideOut var(--speed-normal) var(--bounce-out) forwards;
}

/* Enhanced button effects */
.game-controls button {
    transition: all var(--speed-normal) var(--smooth-out);
    position: relative;
    overflow: hidden;
}

.game-controls button::before {
    content: '';
    position: absolute;
    top: -100%;
    left: -100%;
    width: 300%;
    height: 300%;
    background: radial-gradient(
        circle,
        rgba(255,255,255,0.2),
        transparent 70%
    );
    transform: scale(0);
    transition: transform var(--speed-normal) var(--snap);
}

.game-controls button:not(:disabled):hover {
    animation: buttonHover var(--speed-normal) var(--bounce-out) forwards;
}

.game-controls button:not(:disabled):hover::before {
    transform: scale(1);
}

.game-controls button:not(:disabled):active {
    transform: translateY(2px);
    box-shadow: 0 3px 6px rgba(0,0,0,0.4);
}

/* Enhanced hand container effects */
.hand-enter {
    animation: resultPopIn var(--speed-normal) var(--bounce-out);
}

.hand-exit {
    animation: cardExit var(--speed-normal) var(--smooth-out) forwards;
}

/* Enhanced active hand indicator */
.player-hand-block:not(:has(.hand-status)) {
    position: relative;
}

.player-hand-block:not(:has(.hand-status))::after {
    content: '';
    position: absolute;
    inset: -2px;
    border: 2px solid transparent;
    border-radius: inherit;
    background: linear-gradient(
        45deg,
        var(--accent-red),
        #ff6b6b,
        var(--accent-red)
    ) border-box;
    -webkit-mask: 
        linear-gradient(#fff 0 0) padding-box,
        linear-gradient(#fff 0 0);
    mask: 
        linear-gradient(#fff 0 0) padding-box,
        linear-gradient(#fff 0 0);
    -webkit-mask-composite: destination-out;
    mask-composite: exclude;
    opacity: 0;
    animation: borderGlow 2s ease-in-out infinite;
}

/* Enhanced border glow */
@keyframes borderGlow {
    0%, 100% {
        opacity: 0.3;
        filter: blur(0);
    }
    50% {
        opacity: 0.8;
        filter: blur(1px);
    }
}

/* Additional hover effects for game elements */
.game-table {
    transition: transform var(--speed-normal) var(--smooth-out);
}

.game-table:hover {
    transform: perspective(2000px) translateZ(20px);
}

/* Accessibility - Respect user preferences */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
}